<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module machi_flu_filename_mgr</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module machi_flu_filename_mgr</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>This process is responsible for managing filenames assigned to
  prefixes.


<h2><a name="description">Description</a></h2><p>This process is responsible for managing filenames assigned to
  prefixes. It's started out of <code>machi_flu_psup</code>.</p>
 
  <p>Supported operations include finding the "current" filename assigned to  
a prefix. Incrementing the sequence number and returning a new file name  
and listing all data files assigned to a given prefix.</p>
 
  <p>All prefixes should have the form of <code>{prefix, P}</code>. Single filename
  return values have the form of <code>{file, F}</code>.</p>
 
  <h2>Finding the current file associated with a sequence</h2><p>  
First it looks up the sequence number from the prefix name. If  
no sequence file is found, it uses 0 as the sequence number and searches  
for a matching file with the prefix and 0 as the sequence number.  
If no file is found, the it generates a new filename by incorporating  
the given prefix, a randomly generated (v4) UUID and 0 as the  
sequence number.</p>
 
  If the sequence number is &gt; 0, then the process scans the filesystem
  looking for a filename which matches the prefix and given sequence number and
  returns that.
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#child_spec-2">child_spec/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#code_change-3">code_change/3</a></td><td></td></tr>
<tr><td valign="top"><a href="#find_or_make_filename_from_prefix-3">find_or_make_filename_from_prefix/3</a></td><td>Find the latest available or make a filename from a prefix.</td></tr>
<tr><td valign="top"><a href="#handle_call-3">handle_call/3</a></td><td></td></tr>
<tr><td valign="top"><a href="#handle_cast-2">handle_cast/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#handle_info-2">handle_info/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#increment_prefix_sequence-2">increment_prefix_sequence/2</a></td><td>Increment the sequence counter for a given prefix.</td></tr>
<tr><td valign="top"><a href="#init-1">init/1</a></td><td></td></tr>
<tr><td valign="top"><a href="#list_files_by_prefix-2">list_files_by_prefix/2</a></td><td>Given a prefix in the form of <code>{prefix, P}</code> return
 all the data files associated with that prefix.</td></tr>
<tr><td valign="top"><a href="#start_link-2">start_link/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#terminate-2">terminate/2</a></td><td></td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="child_spec-2">child_spec/2</a></h3>
<div class="spec">
<p><tt>child_spec(FluName, DataDir) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="code_change-3">code_change/3</a></h3>
<div class="spec">
<p><tt>code_change(OldVsn, State, Extra) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="find_or_make_filename_from_prefix-3">find_or_make_filename_from_prefix/3</a></h3>
<div class="spec">
<p><tt>find_or_make_filename_from_prefix(FluName::atom(), EpochId::<a href="#type-pv1_epoch_n">pv1_epoch_n()</a>, Prefix::{prefix, string()}) -&gt; {file, Filename::string()} | {error, Reason::term()} | timeout</tt><br></p>
</div><p>Find the latest available or make a filename from a prefix. A prefix
 should be in the form of a tagged tuple <code>{prefix, P}</code>. Returns a tagged
 tuple in the form of <code>{file, F}</code> or an <code>{error, Reason}</code></p>

<h3 class="function"><a name="handle_call-3">handle_call/3</a></h3>
<div class="spec">
<p><tt>handle_call(Req, From, S) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="handle_cast-2">handle_cast/2</a></h3>
<div class="spec">
<p><tt>handle_cast(Req, State) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="handle_info-2">handle_info/2</a></h3>
<div class="spec">
<p><tt>handle_info(Info, State) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="increment_prefix_sequence-2">increment_prefix_sequence/2</a></h3>
<div class="spec">
<p><tt>increment_prefix_sequence(FluName::atom(), Prefix::{prefix, string()}) -&gt; ok | {error, Reason::term()} | timeout</tt><br></p>
</div><p>Increment the sequence counter for a given prefix. Prefix should
 be in the form of <code>{prefix, P}</code>.</p>

<h3 class="function"><a name="init-1">init/1</a></h3>
<div class="spec">
<p><tt>init(X1) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="list_files_by_prefix-2">list_files_by_prefix/2</a></h3>
<div class="spec">
<p><tt>list_files_by_prefix(FluName::atom(), Prefix::{prefix, string()}) -&gt; [<a href="file.html#type-name">file:name()</a>] | timeout | {error, Reason::term()}</tt><br></p>
</div><p>Given a prefix in the form of <code>{prefix, P}</code> return
 all the data files associated with that prefix. Returns
 a list.</p>

<h3 class="function"><a name="start_link-2">start_link/2</a></h3>
<div class="spec">
<p><tt>start_link(FluName, DataDir) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="terminate-2">terminate/2</a></h3>
<div class="spec">
<p><tt>terminate(Reason, State) -&gt; any()</tt></p>
</div>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Dec 8 2015, 21:37:38.</i></p>
</body>
</html>
